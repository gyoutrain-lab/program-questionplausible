from gpt4all import GPT4All
import csv
import random
import json

# Initialize the local GPT4All model
model = GPT4All("ggml-gpt4all-j-v1.3-groovy")  # adjust the filename to your local model

def generate_options(question, language="id"):
    """
    Generate 4 descriptive options with proportional text for any question,
    assign plausibility tags, correct answer, and detailed rationale.
    """
    prompt = f"""
You are an expert in clinical/scientific reasoning. 
For the following question in {language}:

- Generate 4 answer options.
- One option must be the "Most plausible" (correct answer).
- The other 3 should be scientifically plausible but less ideal, with proportional descriptive narration.
- Assign plausibility tags: Most plausible, Plausible, Less plausible, Not plausible.
- Provide detailed rationale only for the most plausible option.
- Return output in valid JSON format like:
{{
"options": ["Option1","Option2","Option3","Option4"],
"plausibility": ["Most plausible","Plausible","Less plausible","Not plausible"],
"correct_index": 0,
"rationale": "Detailed rationale for the most plausible option"
}}
Question: "{question}"
"""
    response = model.generate(prompt)
    
    try:
        data = json.loads(response.strip())
        return data
    except:
        print(f"[WARNING] Could not parse output. Using fallback for: {question}")
        # Fallback simple generation
        options = [
            f"{question} - Correct action",
            f"{question} - Plausible alternative",
            f"{question} - Less ideal option",
            f"{question} - Not plausible option"
        ]
        plausibility = ["Most plausible","Plausible","Less plausible","Not plausible"]
        random.shuffle(options)
        return {
            "options": options,
            "plausibility": plausibility,
            "correct_index": 0,
            "rationale": f"Rationale for correct option: {question}"
        }

# The rest of the script would include generating the quiz for a list of questions,
# shuffling options, marking the correct answer, and saving to CSV.
